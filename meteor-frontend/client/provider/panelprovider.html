<script>
$(document).on("click", ".modifprovider", function () {
     var rsc = $(this).data('rsc');
     $(".modal-body #dns").val( rsc.dns );
     $(".modal-body #cpu").val( rsc.cpu );
     $(".modal-body #storage").val( rsc.storage.total );
     $(".modal-body #ram").val( rsc.ram.total );
     $(".modal-body #bandwidth").val( rsc.bandwidth.total );
});
</script>

<div class="container-fluid">

	<div ng-hide="isLoggedIn">
		<br>Please connect to go further.
	</div>

	<!-- btn access machine form -->
	<div ng-if="isLoggedIn">
		<div class="btn-toolbar" role="toolbar">
			<div class="btn-group" role="group">
				<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#add">Insert new machine</button>
			</div>
		</div>

		<!-- Insert machine form  -->
		<div class="modal fade text-center" myModal id="add" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">Insert new machine</h4>

						<div class="modal-body">
							<div class="row">
								<form name="newMachineForm" class="form-horizontal">
									<table class="table table-hover">
										<tr>
											<td><label class="control-label">Domain name</label></td>
											<td><input type="text" ng-model="provider.newRessource.dns" name="dns" pattern="(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z](?:[a-z-]*[a-z])" required/></td>
										</tr>
										<tr>
											<td><label class="control-label">CPU (unit: Ghz)</label></td>
											<td><input type="number" ng-model="provider.newRessource.cpu" step="0.1" min="0.1" max="1000" name="cpu" required/></td>
										</tr>
										<tr>
											<td><label class="control-label">RAM (unit: GB)</label></td>
											<td><input type="number" ng-model="provider.newRessource.ram.total" step="0.1" min="0.1" max="1000" name="ram" required/></td>
										</tr>
										<tr>
											<td><label class="control-label">Storage(unit: GB)</label></td>
											<td><input type="number" ng-model="provider.newRessource.storage.total" step="0.1" min="0.1" max="1000" name="storage" required/></td>
										</tr>
										<tr>
											<td><label class="control-label">Bandwidth (unit: Mbps)</label></td>
											<td><input type="number" ng-model="provider.newRessource.bandwidth.total" step="0.1" min="0.1" max="1000" name="bandwidth" required/></td>
										</tr>
									</table>
									<div ng-if="newMachineForm.$invalid" class="alert alert-danger">At least one input have invalid value<br> min value : 0.1 ; max value : 1000<br>Domain name must be (at least) like this : *.* </div>
									<div class="col-sm-offset-3 col-sm-6 text-center">
										<div class="btn-group">
											<button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
										</div>
										<div class="btn-group">
											<button ng-click="provider.insertRessource()" class="btn btn-success" ng-disabled="newMachineForm.$invalid" >Save</button>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

        <!-- modify ressource form  -->
        <div class="modal fade text-center" id="modify_machine" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Modify machines</h4>
                        <div class="modal-body">
                            <div class="row">
                                <form name="ModifyMachineForm" class="form-horizontal">
                                    <table class="table table-hover">
										<tr>
											<td><label class="control-label">Domain name</label></td>
											<td><input type="text" id="dns" ng-model="dns" name="dns" value="" pattern="(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z](?:[a-z-]*[a-z])" required/></td>
										</tr>
                                        <tr>
                                            <td><label class="control-label">CPU (unit: Ghz)</label></td>
                                            <td><input type="number" id="cpu" ng-model="ressource.cpu" value="" step="0.1" min="0.1" max="1000" name="cpu" required/></td>
                                        </tr>
                                        <tr>
                                            <td><label class="control-label">RAM (unit: GB)</label></td>
                                            <td><input type="number" id="ram" value="" ng-model="ressource.ram.total" step="0.1" min="0.1" max="1000" name="ram" required/></td>
                                        </tr>
                                        <tr>
                                            <td><label class="control-label">Storage(unit: GB)</label></td>
                                            <td><input type="number" id="storage" value="" ng-model="ressource.storage" step="0.1" min="0.1" max="1000" name="storage" required/></td>
                                        </tr>
                                        <tr>
                                            <td><label class="control-label">Bandwidth (unit: Mbps)</label></td>
                                            <td><input type="number" id="bandwidth" value="" ng-model="ressource.bandwidth" step="0.1" min="0.1" max="1000" name="bandwidth" required/></td>
                                        </tr>
                                    </table>
									<div ng-if="ModifyMachineForm.$invalid" class="alert alert-danger">At least one input have invalid value<br> min value : 0.1 ; max value : 1000<br>Domain name must be (at least) like this : *.* </div>
                                    <div class="col-sm-offset-3 col-sm-6 text-center">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                                        </div>
                                        <div class="btn-group">
                                            <button ng-click="provider.updateRessource(ressource)" class="btn btn-success" ng-disabled="ModifyMachineForm.$invalid" >Save</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
		<!-- Table ressources provider -->
		<div ng-hide="provider.ressourcesIsEmpty()">
			<table class="table">
				<thead>
					<tr>
						<th>DNS</th>
						<th>CPU</th>
						<th>RAM</th>
						<th>Storage</th>
						<th>Bandwidth</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="ressource in provider.ressources" ng-class="provider.getRowClass(ressource.usable)">
						<td style="vertical-align:middle">{{ressource.dns}}</td>
						<td style="vertical-align:middle">{{ressource.cpu}} Ghz</td>
						<td style="vertical-align:middle">{{ressource.ram.total}} GB</td>
						<td style="vertical-align:middle">{{ressource.storage.total}} GB</td>
						<td style="vertical-align:middle">{{ressource.bandwidth.total}} MBps</td>
						<td>
							<div class="btn-toolbar" role="toolbar">
								<div class="btn-group">
									<button ng-click="provider.startRessource(ressource)" class="btn btn-success centered" ng-disabled="false" style="margin: 0 auto;display: block;">Start</button>
								</div>
								<div class="btn-group">
									<button ng-click="provider.stopRessource(ressource)" class="btn btn-warning centered" ng-disabled="false" style="margin: 0 auto;display: block;">Stop</button>
								</div>
								<div class="btn-group">
									<button ng-click="provider.deleteRessource(ressource)" class="btn btn-danger centered" ng-disabled="false" style="margin: 0 auto;display: block;" ng-confirm-click="Confirm delete">Delete</button>
								</div>
								<button class="btn btn-primary centered modifprovider" ng-disabled="provider.Isusable(ressource)"
                                        data-toggle="modal" data-rsc='{{ressource}}' data-target="#modify_machine"  style="margin: 0 auto;display: block;">Modify</button>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>